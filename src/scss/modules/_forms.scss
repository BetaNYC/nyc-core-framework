@use "sass:map";
@use "breakpoints";
@use "global";

/*

In this file:

// A. Variables
// B. Form Entry Block
// C. Form Entry Elements
// D. Form Entry Modifiers
// E. Browser Behavior Modifications
// F. Form Entry within Nav
// F. Form Feedback and Alerts

*/

//////////////////////////////////////////////
// A. Variables
//////////////////////////////////////////////

:root {
    --form-field-padding-x: var(--spacer-2);
    --form-field-padding-y: var(--button-padding-y);

    --form-field-border-radius: 0.25em;
}

//////////////////////////////////////////////
// B. Form Entry Block
//////////////////////////////////////////////

.form-entry {
    position: relative;

    select,
    textarea,
    input:not([type="radio"]):not([type="checkbox"]):not([type="file"]):not([type="range"]) {
        background-color: transparent;
        color: inherit;
        border-radius: inherit;
        border: 0;
        width: 100%;
    }

    button,
    fieldset {
        border: unset;
    }

    select option {
        color: currentColor !important;
    }

    ::placeholder {
        color: currentColor;
        opacity: 0.675;
    }

    // text-align: left;

    [dir="rtl"] & {
        text-align: right;
    }
}

form > .form-entry ~ .form-entry,
form > .grid, 
form > .button {
    margin-top: var(--spacer-3);
    margin-bottom: var(--spacer-3);
}

//////////////////////////////////////////////
// C. Form Entry Elements
//////////////////////////////////////////////

.form-entry__field {
    position: relative;

    display: flex;
    flex-direction: column;

    color: inherit;
}

.form-entry__field__label {
    font-weight: var(--body-font-weight-bold);
    margin-bottom: 0.5em;

    padding-left: var(--form-field-padding-x);
    padding-right: var(--form-field-padding-x);

    &::after {
        content: "*";
        margin: auto 0.25rem;
        display: none;
        font-size: 80%;
    }
}

// Required Asterisk

.is-required .form-entry__field__label::after {
    display: inline-block !important;
}


.form-entry__field__input {
    position: relative;
    
    display: flex;
    align-items: center;

    border-radius: var(--form-field-border-radius);
    overflow: hidden;
    

    input,
    select, 
    textarea
    {
        padding: var(--form-field-padding-y) var(--form-field-padding-x);
        outline: none;
    }

    button {
        flex-shrink: 0;
    }

    [class*="button--icon-only"] {
        margin-left: calc(var(--form-field-padding-x) / 2);
        margin-right: calc(var(--form-field-padding-x) / 2);
    }
    
    > [class*="nyc_icon"] {
        font-size: 75%;
        margin-left: var(--form-field-padding-x);
    }

    &::after {
        content: "";
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;

        border-radius: inherit;
        pointer-events: none;
        
        box-shadow: inset 0 0 0 var(--default-border-width) currentColor;
    }

    [dir="rtl"] & {
        > [class*="nyc_icon"] {
            margin-left: unset;
            margin-right: var(--form-field-padding-x);
        }
    }
}

.active .form-entry__field__input::after {
    box-shadow: inset 0 0 0 calc( var(--default-border-width) * 3) currentColor;
}

.form-entry__help {
    font-size: 0.8em;
    padding-left: var(--form-field-padding-x);
    padding-right: var(--form-field-padding-x);
    margin-top: var(--spacer-1);
}

.form-entry__field__input.select {
    position: relative;

    &::before {
        content: "";
        @include global.caret-icon;
        pointer-events: none;
        position: absolute;
        right: 0;
        top: 50%;
        transform: translateY(-50%);
        margin-left: var(--spacer-2);
        margin-right: var(--spacer-2);
    }

}

.form-entry__field__input.select::before {
    [dir="rtl"] & {
        right: unset;
        left: 0;
    }
}

//////////////////////////////////////////////
// E. Form Feedback and Alerts
//////////////////////////////////////////////

[data-alert="form-errors"],
.form-entry__feedback,
.form-entry__field__input span.nyc_icon_warn
{
    display: none;
}

.form-entry__feedback {
    order: 3;
    margin-top: 0.5rem;
    font-size: 80%;
    padding-left: var(--form-field-padding-x);
    padding-right: var(--form-field-padding-x);
}

.invalid {
    .form-entry__feedback,
    .form-entry__field__input .nyc_icon_warn
    {
        display: block;
    }
}

//////////////////////////////////////////////
// C. Checkbox and Radio Elements
//////////////////////////////////////////////

fieldset {
    &.form-entry > legend {
        font-weight: bold;
        margin-bottom: var(--spacer-2);
    }
}

.form-entry__options {
    --gap-size: 0.5em;

    clear: both;
    
    display: flex;
    flex-direction: column;
}

.form-entry__options:not([class*="--divider"]){

    > div:not(:last-child) {
        margin-bottom: var(--gap-size);
    }
}

.form-entry__options.options--divider {

    border-radius: var(--form-field-border-radius);

    > div {
        padding: 0.5em var(--spacer-2);
        position: relative;
    }

    > div:not(:last-child) {
        border-bottom-width: var(--default-border-width);
        border-bottom-style: var(--default-border-style);
        border-bottom-color: inherit;
    }

    > div > label {

        &::before {
            top: calc(0.75em * -1);
            left: calc(var(--spacer-2) * -1);
            bottom: calc(0.75em * -1);
            right: calc(var(--spacer-2) * -1);

            pointer-events: inherit;
        }
    }
}

@each $breakpoint in map.keys(breakpoints.$breakpoints) {
    @include breakpoints.breakpoints-up($breakpoint) {
        $mod: breakpoints.breakpoint-modifier($breakpoint, breakpoints.$breakpoints);
        
        .form-entry__options:not([class*="--divider"]).options--horizontal#{$mod} {
            flex-direction: row;

            --gap-size: 1.5em;

            margin-left: calc(-1 * var(--gap-size));
            margin-right: calc(-1 * var(--gap-size));

            > div {
                margin-bottom: unset;
                margin-left: var(--gap-size);
                margin-right: var(--gap-size);
            }

        }

        .options--divider.options--horizontal#{$mod}{
            flex-direction: row;
            align-items: stretch;

            > div {
                flex: 1;
                border-bottom-style: none !important; // Thanks, IE.
            }

            > div:not(:last-child){
                border-right-width: var(--default-border-width);
                border-right-style: var(--default-border-style);

                [dir="rtl"] & {
                    border-right-width: 0;
                    border-left-width: var(--default-border-width);
                    border-left-style: var(--default-border-style);
                }
            }
        }

    }
}

// Shared Styles

.form-entry__options__radio,
.form-entry__options__check {
    position: relative;
    color: inherit;
    display: flex;
    align-items: baseline;
    padding-left: 1em;
    width: auto;
    cursor: pointer;

    [dir="rtl"] & {
        padding-left: unset;
        padding-right: 1em;
    }
}

.form-entry__options__radio > input[type="radio"],
.form-entry__options__check > input[type="checkbox"] {
    background-color: transparent;
    opacity: 0;
} 

.form-entry__options__radio > input ~ .radio__label,
.form-entry__options__check > input ~ .checkbox__label {
    line-height: var(--body-line-height);

    &::before {
        position: absolute;
        top: 0;
        left: 0;
        opacity: 0.5;

        font-size: 125%;
        margin-top: -0.125em;

        @extend .nyc_icon_font !optional;
    }
}

// Unchecked and Checked States

.form-entry__options__check > input ~ .checkbox__label::before {
    content: "\e946";
}

.form-entry__options__check > input:checked ~ .checkbox__label::before {
    content: "\e947";
}

.form-entry__options__radio > input ~ .radio__label::before{
    content: "\e948";
}

.form-entry__options__radio > input:checked ~ .radio__label::before{
    content: "\e949";
}

// Focus State

.form-entry__options__radio > input:focus ~ .radio__label,
.form-entry__options__check > input:focus ~ .checkbox__label {
    text-decoration: underline;
    &::before{
        opacity: 0.75;
    }
}

.form-entry__options__radio > input:checked ~ .radio__label,
.form-entry__options__check > input:checked ~ .checkbox__label {
    // color: var(--primary);
    &::before{
        opacity: 1;
    }
}

// RTL

[dir="rtl"] {
    .form-entry__options__radio > .radio__label::before,
    .form-entry__options__radio > input[type="radio"],

    .form-entry__options__check > .checkbox__label::before,
    .form-entry__options__check > .checkbox__label::after,
    .form-entry__options__check > input[type="checkbox"] {
        left: unset;
        right: 0;
    }
}